<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" th:href="@{/css/styles.css}" />
<body th:replace="~{fragments/_layout :: layout(~{this :: pageContent}, 'list')}">

<div th:fragment="pageContent">
    <section class="banner">Reserve/Recover actions available when the PATCH API is ready</section>

    <!-- Flash messages -->
    <div th:if="${ok}" style="color:green; margin-bottom:8px;" th:text="${ok}"></div>
    <div th:if="${error}" style="color:red; margin-bottom:8px;" th:text="${error}"></div>

    <div class="controls">
        <form method="get" th:action="@{/ui/ghostnets}">
            <label for="status">Filter by status:</label>
            <select name="status" id="status" onchange="this.form.submit()">
                <!-- use a real empty value for All -->
                <option value="" th:selected="${selectedStatus == ''}">All</option>
                <option th:value="REPORTED" th:selected="${selectedStatus == 'REPORTED'}">REPORTED</option>
                <option th:value="RECOVERY_PENDING" th:selected="${selectedStatus == 'RECOVERY_PENDING'}">RECOVERY_PENDING</option>
                <option th:value="RECOVERED" th:selected="${selectedStatus == 'RECOVERED'}">RECOVERED</option>
                <option th:value="MISSING" th:selected="${selectedStatus == 'MISSING'}">MISSING</option>
            </select>
        </form>

        <a class="btn btn-primary" th:href="@{/ui/ghostnets/new}">Report net</a>
    </div>

    <table class="table" style="margin-top:12px;">
        <thead>
        <tr>
            <th>ID</th>
            <th>Location</th>
            <th>Size</th>
            <th>Status</th>
            <th>CreatedAt</th>
            <th>RecoveringPerson</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${ghostNets == null or #lists.isEmpty(ghostNets)}">
            <td colspan="7">
                <div class="empty-state">
                    <div class="icon">ü™ù</div>
                    <p>No ghost nets reported yet.</p>
                    <a class="btn btn-primary" th:href="@{/ui/ghostnets/new}">Report net</a>
                </div>
            </td>
        </tr>
        <tr th:each="g : ${ghostNets}">
            <td th:text="${g.id}">1</td>
            <td th:text="${g.location}">Location</td>
            <td th:text="${g.size}">0.0</td>
            <td><span th:text="${g.status}" th:class="'badge ' + ${g.status}">STATUS</span></td>
            <td th:text="${#temporals.format(g.createdAt, 'yyyy-MM-dd HH:mm')}">--</td>

            <!-- show 'anonymous' if no person -->
            <td th:text="${g.recoveringPersonName != null ? g.recoveringPersonName : 'anonymous'}"></td>

            <td>
                <!-- GET links to reserve/recover forms are implemented in the controller -->
                <a th:href="@{|/ui/ghostnets/${g.id}/reserve|}"
                   class="btn btn-ghost"
                   th:attr="title=${'Reserve ghost net ' + g.id}, aria-label=${'Reserve ghost net ' + g.id}">Reserve</a>

                <a th:href="@{|/ui/ghostnets/${g.id}/recover|}"
                   class="btn btn-ghost"
                   th:attr="title=${'Mark recovered net ' + g.id}, aria-label=${'Mark recovered net ' + g.id}">Recover</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>
