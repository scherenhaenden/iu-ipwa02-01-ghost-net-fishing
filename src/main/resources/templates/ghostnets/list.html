<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" th:href="@{/css/styles.css}" />
<body th:replace="~{fragments/_layout :: layout(~{this :: pageContent}, 'list')}">

<div th:fragment="pageContent">
    <section class="banner">Acciones Reserve/Recover disponibles cuando la API PATCH est칠 lista</section>

    <!-- Mensajes flash -->
    <div th:if="${ok}" style="color:green; margin-bottom:8px;" th:text="${ok}"></div>
    <div th:if="${error}" style="color:red; margin-bottom:8px;" th:text="${error}"></div>

    <div class="controls">
        <form method="get" th:action="@{/ui/ghostnets}">
            <label for="status">Filtrar por estado:</label>
            <select name="status" id="status" onchange="this.form.submit()">
                <!-- th:value vac칤o causaba la excepci칩n; usar literal cadena vac칤a '' -->
                <option th:value="''" th:selected="${selectedStatus == ''}">Todos</option>
                <option th:value="REPORTED" th:selected="${selectedStatus == 'REPORTED'}">REPORTED</option>
                <option th:value="RECOVERY_PENDING" th:selected="${selectedStatus == 'RECOVERY_PENDING'}">RECOVERY_PENDING</option>
                <option th:value="RECOVERED" th:selected="${selectedStatus == 'RECOVERED'}">RECOVERED</option>
                <option th:value="MISSING" th:selected="${selectedStatus == 'MISSING'}">MISSING</option>
            </select>
        </form>

        <a class="btn btn-primary" th:href="@{/ui/ghostnets/new}">Reportar net</a>
    </div>

    <table class="table" style="margin-top:12px;">
        <thead>
        <tr>
            <th>ID</th>
            <th>Location</th>
            <th>Size</th>
            <th>Status</th>
            <th>CreatedAt</th>
            <th>RecoveringPerson</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${ghostNets == null or #lists.isEmpty(ghostNets)}">
            <td colspan="7">
                <div class="empty-state">
                    <div class="icon">游뿧</div>
                    <p>No hay ghost nets reportadas todav칤a.</p>
                    <a class="btn btn-primary" th:href="@{/ui/ghostnets/new}">Reportar net</a>
                </div>
            </td>
        </tr>
        <tr th:each="g : ${ghostNets}">
            <td th:text="${g.id}">1</td>
            <td th:text="${g.location}">Location</td>
            <td th:text="${g.size}">0.0</td>
            <td><span th:text="${g.status}" th:class="'badge ' + ${g.status}">STATUS</span></td>
            <td th:text="${#temporals.format(g.createdAt, 'yyyy-MM-dd HH:mm')}">--</td>

            <!-- mostrar 'an칩nimo' si no hay persona -->
            <td th:text="${g.recoveringPerson != null ? g.recoveringPerson.name : 'an칩nimo'}"></td>

            <td>
                <!-- Los enlaces GET a los formularios de reserve/recover est치n implementados en el controller -->
                <a th:href="@{|/ui/ghostnets/${g.id}/reserve|}"
                   class="btn btn-ghost"
                   th:attr="title=${'Reservar ghost net ' + g.id}, aria-label=${'Reservar ghost net ' + g.id}">Reserve</a>

                <a th:href="@{|/ui/ghostnets/${g.id}/recover|}"
                   class="btn btn-ghost"
                   th:attr="title=${'Marcar recuperado net ' + g.id}, aria-label=${'Marcar recuperado net ' + g.id}">Recover</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>
